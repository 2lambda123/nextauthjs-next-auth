"use strict";(self.webpackChunknext_auth_docs=self.webpackChunknext_auth_docs||[]).push([[2389],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,y=d["".concat(s,".").concat(m)]||d[m]||p[m]||o;return n?a.createElement(y,i(i({ref:t},c),{},{components:n})):a.createElement(y,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8215:function(e,t,n){var a=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},6396:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(7462),r=n(7294),o=n(2389),i=n(9443);var l=function(){var e=(0,r.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=n(9521),u=n(6010),c="tabItem_vU9c";function p(e){var t,n,a,o=e.lazy,i=e.block,p=e.defaultValue,d=e.values,m=e.groupId,y=e.className,h=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),b=null!=d?d:h.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),f=(0,s.lx)(b,(function(e,t){return e.value===t.value}));if(f.length>0)throw new Error('Docusaurus error: Duplicate values "'+f.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var v=null===p?p:null!=(t=null!=p?p:null==(n=h.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(a=h[0])?void 0:a.props.value;if(null!==v&&!b.some((function(e){return e.value===v})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+b.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var k=l(),g=k.tabGroupChoices,N=k.setTabGroupChoices,T=(0,r.useState)(v),x=T[0],w=T[1],D=[],S=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var A=g[m];null!=A&&A!==x&&b.some((function(e){return e.value===A}))&&w(A)}var E=function(e){var t=e.currentTarget,n=D.indexOf(t),a=b[n].value;a!==x&&(S(t),w(a),null!=m&&N(m,a))},I=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=D.indexOf(e.currentTarget)+1;n=D[a]||D[0];break;case"ArrowLeft":var r=D.indexOf(e.currentTarget)-1;n=D[r]||D[D.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":i},y)},b.map((function(e){var t=e.value,n=e.label;return r.createElement("li",{role:"tab",tabIndex:x===t?0:-1,"aria-selected":x===t,className:(0,u.Z)("tabs__item",c,{"tabs__item--active":x===t}),key:t,ref:function(e){return D.push(e)},onKeyDown:I,onFocus:E,onClick:E},null!=n?n:t)}))),o?(0,r.cloneElement)(h.filter((function(e){return e.props.value===x}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},h.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==x})}))))}function d(e){var t=(0,o.Z)();return r.createElement(p,(0,a.Z)({key:String(t)},e))}},9443:function(e,t,n){var a=(0,n(7294).createContext)(void 0);t.Z=a},6533:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return d},default:function(){return y}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=n(6396),l=n(8215),s=["components"],u={id:"dynamodb",title:"DynamoDB"},c="DynamoDB",p={unversionedId:"adapters/dynamodb",id:"adapters/dynamodb",isDocsHomePage:!1,title:"DynamoDB",description:"This is the AWS DynamoDB Adapter for next-auth. This package can only be used in conjunction with the primary next-auth package. It is not a standalone package.",source:"@site/docs/adapters/dynamodb.md",sourceDirName:"adapters",slug:"/adapters/dynamodb",permalink:"/adapters/dynamodb",editUrl:"https://github.com/nextauthjs/docs/edit/main/docs/adapters/dynamodb.md",tags:[],version:"current",lastUpdatedBy:"Bal\xe1zs Orb\xe1n",lastUpdatedAt:1643982356,formattedLastUpdatedAt:"2/4/2022",frontMatter:{id:"dynamodb",title:"DynamoDB"},sidebar:"docs",previous:{title:"FaunaDB",permalink:"/adapters/fauna"},next:{title:"Firebase",permalink:"/adapters/firebase"}},d=[{value:"Getting Started",id:"getting-started",children:[],level:2},{value:"Schema",id:"schema",children:[],level:2},{value:"Custom Schema",id:"custom-schema",children:[],level:2}],m={toc:d};function y(e){var t=e.components,n=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"dynamodb"},"DynamoDB"),(0,o.kt)("p",null,"This is the AWS DynamoDB Adapter for next-auth. This package can only be used in conjunction with the primary next-auth package. It is not a standalone package."),(0,o.kt)("p",null,"By default, the adapter expects a table with a partition key ",(0,o.kt)("inlineCode",{parentName:"p"},"pk")," and a sort key ",(0,o.kt)("inlineCode",{parentName:"p"},"sk"),", as well as a global secondary index named ",(0,o.kt)("inlineCode",{parentName:"p"},"GSI1")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"GSI1PK")," as partition key and ",(0,o.kt)("inlineCode",{parentName:"p"},"GSI1SK")," as sorting key. To automatically delete sessions and verification requests after they expire using ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/TTL.html"},"dynamodb TTL")," you should ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/time-to-live-ttl-how-to.html"},"enable the TTL")," with attribute name 'expires'. You can set whatever you want as the table name and the billing method. "),(0,o.kt)("p",null,"You can find the full schema in the table structure section below."),(0,o.kt)("h2",{id:"getting-started"},"Getting Started"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Install ",(0,o.kt)("inlineCode",{parentName:"li"},"next-auth")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"@next-auth/dynamodb-adapter"))),(0,o.kt)(i.Z,{groupId:"npm2yarn",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"npm",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm install next-auth @next-auth/dynamodb-adapter\n"))),(0,o.kt)(l.Z,{value:"yarn",label:"Yarn",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add next-auth @next-auth/dynamodb-adapter\n")))),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Add this adapter to your ",(0,o.kt)("inlineCode",{parentName:"li"},"pages/api/auth/[...nextauth].js")," next-auth configuration object.")),(0,o.kt)("p",null,"You need to pass ",(0,o.kt)("inlineCode",{parentName:"p"},"DynamoDBDocument")," client from the modular ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/dynamodb-example-dynamodb-utilities.html"},(0,o.kt)("inlineCode",{parentName:"a"},"aws-sdk"))," v3 to the adapter.\nThe default table name is ",(0,o.kt)("inlineCode",{parentName:"p"},"next-auth"),", but you can customise that by passing ",(0,o.kt)("inlineCode",{parentName:"p"},"{ tableName: 'your-table-name' }")," as the second parameter in the adapter."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="pages/api/auth/[...nextauth].js"',title:'"pages/api/auth/[...nextauth].js"'},'import { DynamoDB } from "@aws-sdk/client-dynamodb"\nimport { DynamoDBDocument } from "@aws-sdk/lib-dynamodb"\nimport NextAuth from "next-auth";\nimport Providers from "next-auth/providers";\nimport { DynamoDBAdapter } from "@next-auth/dynamodb-adapter"\n\nconst config: DynamoDBClientConfig = {\n  credentials: {\n    accessKeyId: process.env.NEXT_AUTH_AWS_ACCESS_KEY as string,\n    secretAccessKey: process.env.NEXT_AUTH_AWS_SECRET_KEY as string,\n  },\n  region: process.env.NEXT_AUTH_AWS_REGION,\n};\n\nconst client = DynamoDBDocument.from(new DynamoDB(config), {\n  marshallOptions: {\n    convertEmptyValues: true,\n    removeUndefinedValues: true,\n    convertClassInstanceToMap: true,\n  },\n})\n\nexport default NextAuth({\n  // Configure one or more authentication providers\n  providers: [\n    Providers.GitHub({\n      clientId: process.env.GITHUB_ID,\n      clientSecret: process.env.GITHUB_SECRET,\n    }),\n    Providers.Email({\n      server: process.env.EMAIL_SERVER,\n      from: process.env.EMAIL_FROM,\n    }),\n    // ...add more providers here\n  ],\n  adapter: DynamoDBAdapter(\n    client\n  ),\n  ...\n});\n')),(0,o.kt)("p",null,"(AWS secrets start with ",(0,o.kt)("inlineCode",{parentName:"p"},"NEXT_AUTH_")," in order to not conflict with ",(0,o.kt)("a",{parentName:"p",href:"https://vercel.com/docs/environment-variables#reserved-environment-variables"},"Vercel's reserved environment variables"),".)"),(0,o.kt)("h2",{id:"schema"},"Schema"),(0,o.kt)("p",null,"The table respects the single table design pattern. This has many advantages:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Only one table to manage, monitor and provision."),(0,o.kt)("li",{parentName:"ul"},"Querying relations is faster than with multi-table schemas (for eg. retrieving all sessions for a user)."),(0,o.kt)("li",{parentName:"ul"},"Only one table needs to be replicated, if you want to go multi-region.")),(0,o.kt)("p",null,"Here is the default schema of the table:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/hGZtWDq.png",alt:"DynamoDB Table"})),(0,o.kt)("p",null,"You can create this table with infrastructure as code using ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/aws/aws-cdk"},"aws cdk")," with the following table definition:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title=stack.ts",title:"stack.ts"},"new dynamodb.Table(this, `NextAuthTable`, {\n  tableName: 'next-auth',\n  partitionKey: { name: 'pk', type: dynamodb.AttributeType.STRING },\n  sortKey: { name: 'sk', type: dynamodb.AttributeType.STRING },\n  timeToLiveAttribute: 'expires',\n}).addGlobalSecondaryIndex({\n  indexName: 'GSI1',\n  partitionKey: { name: 'GSI1PK', type: dynamodb.AttributeType.STRING },\n  sortKey: { name: 'GSI1SK', type: dynamodb.AttributeType.STRING },\n})\n")),(0,o.kt)("p",null,"Alternatively you can use this cloudformation template:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title=cloudformation.yaml",title:"cloudformation.yaml"},'NextAuthTable:\n  Type: "AWS::DynamoDB::Table"\n  Properties:\n    TableName: next-auth\n    AttributeDefinitions:\n      - AttributeName: pk\n        AttributeType: S\n      - AttributeName: sk\n        AttributeType: S\n      - AttributeName: GSI1PK\n        AttributeType: S\n      - AttributeName: GSI1SK\n        AttributeType: S\n    KeySchema:\n      - AttributeName: pk\n        KeyType: HASH\n      - AttributeName: sk\n        KeyType: RANGE\n    GlobalSecondaryIndexes:\n      - IndexName: GSI1\n        KeySchema:\n          - AttributeName: GSI1PK\n            KeyType: HASH\n          - AttributeName: GSI1SK\n            KeyType: RANGE\n    TimeToLiveSpecification:\n      AttributeName: expires\n      Enabled: true\n')),(0,o.kt)("h2",{id:"custom-schema"},"Custom Schema"),(0,o.kt)("p",null,"You can configure your custom table schema by passing the ",(0,o.kt)("inlineCode",{parentName:"p"},"options")," key to the adapter constructor:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'const adapter = DynamoDBAdapter(client, {\n  tableName: "custom-table-name",\n  partitionKey: "custom-pk",\n  sortKey: "custom-sk",\n  indexName: "custom-index-name",\n  indexPartitionKey: "custom-index-pk",\n  indexSortKey: "custom-index-sk",\n})\n')))}y.isMDXComponent=!0}}]);