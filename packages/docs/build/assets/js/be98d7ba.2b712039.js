"use strict";(self.webpackChunknext_auth_docs=self.webpackChunknext_auth_docs||[]).push([[1825],{3905:function(e,a,t){t.d(a,{Zo:function(){return d},kt:function(){return c}});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),p=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},d=function(e){var a=p(e.components);return n.createElement(i.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(t),c=r,h=m["".concat(i,".").concat(c)]||m[c]||u[c]||s;return t?n.createElement(h,o(o({ref:a},d),{},{components:t})):n.createElement(h,o({ref:a},d))}));function c(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var s=t.length,o=new Array(s);o[0]=m;var l={};for(var i in a)hasOwnProperty.call(a,i)&&(l[i]=a[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<s;p++)o[p]=t[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},8404:function(e,a,t){t.r(a),t.d(a,{frontMatter:function(){return l},contentTitle:function(){return i},metadata:function(){return p},toc:function(){return d},default:function(){return m}});var n=t(7462),r=t(3366),s=(t(7294),t(3905)),o=["components"],l={id:"databases",title:"Databases"},i=void 0,p={unversionedId:"configuration/databases",id:"version-v3/configuration/databases",isDocsHomePage:!1,title:"Databases",description:"NextAuth.js comes with multiple ways of connecting to a database:",source:"@site/versioned_docs/version-v3/configuration/databases.md",sourceDirName:"configuration",slug:"/configuration/databases",permalink:"/v3/configuration/databases",editUrl:"https://github.com/nextauthjs/docs/edit/main/versioned_docs/version-v3/configuration/databases.md",tags:[],version:"v3",lastUpdatedBy:"Bal\xe1zs Orb\xe1n",lastUpdatedAt:1643982356,formattedLastUpdatedAt:"2/4/2022",frontMatter:{id:"databases",title:"Databases"},sidebar:"version-v3/docs",previous:{title:"Providers",permalink:"/v3/configuration/providers"},next:{title:"Pages",permalink:"/v3/configuration/pages"}},d=[{value:"How to use a database",id:"how-to-use-a-database",children:[],level:2},{value:"Setting up a database",id:"setting-up-a-database",children:[],level:2},{value:"Supported databases",id:"supported-databases",children:[{value:"MySQL",id:"mysql",children:[{value:"Example",id:"example",children:[],level:4}],level:3},{value:"MariaDB",id:"mariadb",children:[{value:"Example",id:"example-1",children:[],level:4}],level:3},{value:"Postgres / CockroachDB",id:"postgres--cockroachdb",children:[{value:"Example",id:"example-2",children:[],level:4}],level:3},{value:"Microsoft SQL Server",id:"microsoft-sql-server",children:[{value:"Example",id:"example-3",children:[],level:4}],level:3},{value:"MongoDB",id:"mongodb",children:[{value:"Example",id:"example-4",children:[],level:4}],level:3},{value:"SQLite",id:"sqlite",children:[{value:"Example",id:"example-5",children:[],level:4}],level:3}],level:2},{value:"Other databases",id:"other-databases",children:[],level:2}],u={toc:d};function m(e){var a=e.components,t=(0,r.Z)(e,o);return(0,s.kt)("wrapper",(0,n.Z)({},u,t,{components:a,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"NextAuth.js comes with multiple ways of connecting to a database:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"TypeORM")," (default)",(0,s.kt)("br",null),(0,s.kt)("em",{parentName:"li"},"The TypeORM adapter supports MySQL, PostgreSQL, MSSQL, SQLite and MongoDB databases.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Prisma"),(0,s.kt)("br",null),(0,s.kt)("em",{parentName:"li"},"The Prisma 2 adapter supports MySQL, PostgreSQL and SQLite databases.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Fauna"),(0,s.kt)("br",null),(0,s.kt)("em",{parentName:"li"},"The FaunaDB adapter only supports FaunaDB.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Custom Adapter"),(0,s.kt)("br",null),(0,s.kt)("em",{parentName:"li"},"A custom Adapter can be used to connect to any database."))),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"There are currently efforts in the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/nextauthjs/adapters"},(0,s.kt)("inlineCode",{parentName:"a"},"nextauthjs/adapters"))," repository to get community-based DynamoDB, Sanity, PouchDB and Sequelize Adapters merged. If you are interested in any of the above, feel free to check out the PRs in the ",(0,s.kt)("inlineCode",{parentName:"p"},"nextauthjs/adapters")," repository!")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"This document covers the default adapter (TypeORM).")),(0,s.kt)("p",null,"See the ",(0,s.kt)("a",{parentName:"p",href:"/adapters/overview"},"documentation for adapters")," to learn more about using Prisma adapter or using a custom adapter."),(0,s.kt)("p",null,"To learn more about databases in NextAuth.js and how they are used, check out ",(0,s.kt)("a",{parentName:"p",href:"/faq#databases"},"databases in the FAQ"),"."),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"how-to-use-a-database"},"How to use a database"),(0,s.kt)("p",null,"You can specify database credentials as as a connection string or a ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/typeorm/typeorm/blob/master/docs/using-ormconfig.md"},"TypeORM configuration")," object."),(0,s.kt)("p",null,"The following approaches are exactly equivalent:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'database: "mysql://nextauth:password@127.0.0.1:3306/database_name"\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"database: {\n  type: 'mysql',\n  host: '127.0.0.1',\n  port: 3306,\n  username: 'nextauth',\n  password: 'password',\n  database: 'database_name'\n}\n")),(0,s.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"You can pass in any valid ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/typeorm/typeorm/blob/master/docs/using-ormconfig.md"},"TypeORM configuration option"),"."),(0,s.kt)("p",{parentName:"div"},(0,s.kt)("em",{parentName:"p"},"e.g. To set a prefix for all table names you can use the ",(0,s.kt)("strong",{parentName:"em"},"entityPrefix")," option as connection string parameter:")),(0,s.kt)("pre",{parentName:"div"},(0,s.kt)("code",{parentName:"pre",className:"language-js"},'"mysql://nextauth:password@127.0.0.1:3306/database_name?entityPrefix=nextauth_"\n')),(0,s.kt)("p",{parentName:"div"},(0,s.kt)("em",{parentName:"p"},"\u2026or as a database configuration object:")),(0,s.kt)("pre",{parentName:"div"},(0,s.kt)("code",{parentName:"pre",className:"language-js"},"database: {\n  type: 'mysql',\n  host: '127.0.0.1',\n  port: 3306,\n  username: 'nextauth',\n  password: 'password',\n  database: 'database_name',\n  entityPrefix: 'nextauth_'\n}\n")))),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"setting-up-a-database"},"Setting up a database"),(0,s.kt)("p",null,"Using SQL to create tables and columns is the recommended way to set up an SQL database for NextAuth.js."),(0,s.kt)("p",null,"Check out the links below for SQL you can run to set up a database for NextAuth.js."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/v3/adapters/typeorm/mysql"},"MySQL Schema")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/v3/adapters/typeorm/postgres"},"Postgres Schema"))),(0,s.kt)("p",null,(0,s.kt)("em",{parentName:"p"},"If you are running SQLite, MongoDB or a Document database you can skip this step.")),(0,s.kt)("p",null,"Alternatively, you can also have your database configured automatically using the ",(0,s.kt)("inlineCode",{parentName:"p"},"synchronize: true")," option:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'database: "mysql://nextauth:password@127.0.0.1:3306/database_name?synchronize=true"\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"database: {\n  type: 'mysql',\n  host: '127.0.0.1',\n  port: 3306,\n  username: 'nextauth',\n  password: 'password',\n  database: 'database_name',\n  synchronize: true\n}\n")),(0,s.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},(0,s.kt)("strong",{parentName:"p"},"The ",(0,s.kt)("inlineCode",{parentName:"strong"},"synchronize")," option should not be used against production databases.")),(0,s.kt)("p",{parentName:"div"},"It is useful to create the tables you need when setting up a database for the first time, but it should not be enabled against production databases as it may result in data loss if there is a difference between the schema that found in the database and the schema that the version of NextAuth.js being used is expecting."))),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"supported-databases"},"Supported databases"),(0,s.kt)("p",null,"The default database adapter is TypeORM, but only some databases supported by TypeORM are supported by NextAuth.js as custom logic needs to be handled by NextAuth.js."),(0,s.kt)("p",null,"Databases compatible with MySQL, Postgres and MongoDB should work out of the box with NextAuth.js. When used with any other database, NextAuth.js will assume an ANSI SQL compatible database."),(0,s.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"When configuring your database you also need to install an appropriate ",(0,s.kt)("strong",{parentName:"p"},"node module")," for your database."))),(0,s.kt)("h3",{id:"mysql"},"MySQL"),(0,s.kt)("p",null,"Install module:\n",(0,s.kt)("inlineCode",{parentName:"p"},"npm i mysql")),(0,s.kt)("h4",{id:"example"},"Example"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'database: "mysql://username:password@127.0.0.1:3306/database_name"\n')),(0,s.kt)("h3",{id:"mariadb"},"MariaDB"),(0,s.kt)("p",null,"Install module:\n",(0,s.kt)("inlineCode",{parentName:"p"},"npm i mariadb")),(0,s.kt)("h4",{id:"example-1"},"Example"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'database: "mariadb://username:password@127.0.0.1:3306/database_name"\n')),(0,s.kt)("h3",{id:"postgres--cockroachdb"},"Postgres / CockroachDB"),(0,s.kt)("p",null,"Install module:\n",(0,s.kt)("inlineCode",{parentName:"p"},"npm i pg")),(0,s.kt)("h4",{id:"example-2"},"Example"),(0,s.kt)("p",null,"PostgresDB"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'database: "postgres://username:password@127.0.0.1:5432/database_name"\n')),(0,s.kt)("p",null,"CockroachDB"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'database: "postgres://username:password@127.0.0.1:26257/database_name"\n')),(0,s.kt)("p",null,"If the node is using Self-signed cert"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"database: {\n    type: \"cockroachdb\",\n    host: process.env.DATABASE_HOST,\n    port: 26257,\n    username: process.env.DATABASE_USER,\n    password: process.env.DATABASE_PASSWORD,\n    database: process.env.DATABASE_NAME,\n    ssl: {\n      rejectUnauthorized: false,\n      ca: fs.readFileSync('/path/to/server-certificates/root.crt').toString()\n    },\n  },\n")),(0,s.kt)("p",null,"Read more: ",(0,s.kt)("a",{parentName:"p",href:"https://node-postgres.com/features/ssl"},"https://node-postgres.com/features/ssl")),(0,s.kt)("hr",null),(0,s.kt)("h3",{id:"microsoft-sql-server"},"Microsoft SQL Server"),(0,s.kt)("p",null,"Install module:\n",(0,s.kt)("inlineCode",{parentName:"p"},"npm i mssql")),(0,s.kt)("h4",{id:"example-3"},"Example"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'database: "mssql://sa:password@localhost:1433/database_name"\n')),(0,s.kt)("h3",{id:"mongodb"},"MongoDB"),(0,s.kt)("p",null,"Install module:\n",(0,s.kt)("inlineCode",{parentName:"p"},"npm i mongodb")),(0,s.kt)("h4",{id:"example-4"},"Example"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'database: "mongodb://username:password@127.0.0.1:3306/database_name"\n')),(0,s.kt)("h3",{id:"sqlite"},"SQLite"),(0,s.kt)("p",null,(0,s.kt)("em",{parentName:"p"},"SQLite is intended only for development / testing and not for production use.")),(0,s.kt)("p",null,"Install module:\n",(0,s.kt)("inlineCode",{parentName:"p"},"npm i sqlite3")),(0,s.kt)("h4",{id:"example-5"},"Example"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'database: "sqlite://localhost/:memory:"\n')),(0,s.kt)("h2",{id:"other-databases"},"Other databases"),(0,s.kt)("p",null,"See the ",(0,s.kt)("a",{parentName:"p",href:"/adapters/overview"},"documentation for adapters")," for more information on advanced configuration, including how to use NextAuth.js with other databases using a ",(0,s.kt)("a",{parentName:"p",href:"/tutorials/creating-a-database-adapter"},"custom adapter"),"."))}m.isMDXComponent=!0}}]);