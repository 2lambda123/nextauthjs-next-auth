---
title: OAuth authentication
---

import creatingOauthAppImg from "./img/getting-started-creating-oauth-app.png"
import addingCallbackUrlImg from "./img/getting-started-oauth-callback-url.png"
import gettingClientIdSecretImg from "./img/getting-started-oauth-clientid-secret.png"
import startAppAndSignInImg from "./img/getting-started-app-start.png"
import githubAuthCredentials from "./img/getting-started-github-auth.png"
import nextAuthUserLoggedIn from "./img/getting-started-nextauth-success.png"
import Tabs from "@theme/Tabs"
import TabItem from "@theme/TabItem"

We understand that authentication is tedious - It is a rabbit hole that is super easy to get lost on. The goal of making Auth.js is to help you easily add authentication to your project with just a few lines of code.

The easiest way is to set up Auth.js with an [OAuth](https://en.wikipedia.org/wiki/OAuth) provider. In this tutorial, we'll be setting Auth.js in an application with a framework of your choice to be able to log in with **GitHub**.

:::info
Auth.js comes with a long list of [built-in providers](/reference/providers/oauth-builtin) (Google, Facebook, Twitter, etc.). You can also integrate it with your OAuth service easily by [building a custom provider](/guides/providers/custom-provider).
:::

## 1. Configuring Auth.js

To add Auth.js to your project:

<Tabs groupId="frameworks" queryString>
  <TabItem value="next" label="Next.js" default>

### Creating the server config

Create the following [API route](https://nextjs.org/docs/api-routes/introduction) file:

```
pages/api/auth/[...nextauth].ts
```

This route will contain the **dynamic route handler** for Auth.js that describes your global auth configuration:

```ts title="pages/api/auth/[...nextauth].js"
import NextAuth from "next-auth"
import GithubProvider from "next-auth/providers/github"

export default NextAuth({
  providers: [
    GithubProvider({
      clientId: process.env.GITHUB_ID,
      clientSecret: process.env.GITHUB_SECRET,
    }),
  ],
})
```

You may notice we are using environment variables in the code example above. We take the value of `GITHUB_ID` and `GITHUB_SECRET` from the GitHub Developer OAuth Portal. See [Configuring OAuth Provider](/getting-started/oauth-tutorial#2-configuring-oauth-provider) section on how to get those.

:::info

Behind the scenes, this creates all the relevant OAuth API routes within `/api/auth/*` so that auth API requests to:

- `/api/auth/callback`
- `/api/auth/signin`
- `/api/auth/signout`
- etc.

can be handled by Auth.js. In this way, Auth.js stays in charge of the whole application's authentication request/response flow.

Auth.js is fullly customizable - [our guides section](/guides/overview) will teach you how to set it up to handle auth in different ways. All the possible configuration options are [listed here](/reference/configuration/auth-config).
:::

### Adding environment variables

In your project root, create a `.env.local` file and add the following environment variables:

```title=".env.local"
NEXTAUTH_SECRET="This is an example"
```

`NEXTAUTH_SECRET` is a random string used by the library to encrypt tokens and email verification hashes, and **it's mandatory to keep things secure**! üî• üîê . You can use:

```
$ openssl rand -base64 32
```

or https://generate-secret.vercel.app/32 to generate a random value for it.

### Exposing the session via `SessionProvider`:

To use `useSession` first you'll need to expose the session context - [`<SessionProvider />`](/reference/react/#sessionprovider) - at the top level of your application:

```ts title="pages/_app.tsx"
import { SessionProvider } from "next-auth/react"

export default function App({
  Component,
  pageProps: { session, ...pageProps },
}) {
  return (
    <SessionProvider session={session}>
      <Component {...pageProps} />
    </SessionProvider>
  )
}
```

Instances of `useSession` (more on it in the next section) will have access to the session data and status. The `<SessionProvider />` also keep the session updated and synced between browser tabs and windows. üí™üèΩ

:::tip
Check our [client docs](/reference/react/) to learn all the available options for handling sessions on the browser.
:::

### Consuming the session via hooks

Auth.js exposes a [`useSession()`](/reference/react/#usesession) React Hook so that you can check if someone is logged in:

```ts title="pages/overview.tsx"
import { useSession, signIn, signOut } from "next-auth/react"

export default function CamperVanPage() {
  const { data: session, status } = useSession()
  const userEmail = session?.user.email

  if (status === "loading") {
    return <p>Hang on there...</p>
  }

  if (status === "authenticated") {
    return (
      <>
        <p>Signed in as {userEmail}</p>
        <button onClick={() => signOut()}>Sign out</button>
        <img src="https://cdn.pixabay.com/photo/2017/08/11/19/36/vw-2632486_1280.png" />
      </>
    )
  }

  return (
    <>
      <p>Not signed in.</p>
      <button onClick={() => signIn()}>Sign in</button>
    </>
  )
}
```

You can use the `useSession` hook from anywhere in your application (E.g. in a header component). Behind the scenes, the hook will connect to the `<SessionProvider />` to read the current user session.

### Protecting API Routes

Protecting your API Routes (blocking unauthorized access to resources) is easy! You can use [`getServerSession()`](/reference/nextjs#getserversession) to know whether a session exists or not:

```ts title="pages/api/movies/list.ts"
import { getServerSession } from "next-auth/next"
import authOptions from "@/pages/api/auth/[...nextauth]"

export default async function listMovies(req, res) {
  const session = await getServerSession(req, res, authOptions)

  if (session) {
    res.send({
      movies: [
        { title: "Alien vs Predator", id: 1 },
        { title: "Reservoir Dogs", id: 2 },
      ],
    })
  } else {
    res.send({
      error: "You must sign in to view movies.",
    })
  }
}
```

  </TabItem>
  <TabItem value="sveltekit" label="SvelteKit">
TODO: SvelteKit
  </TabItem>
  <TabItem value="solidstart" label="SolidStart">
TODO: SolidStart
  </TabItem>
</Tabs>

## 2. Configuring OAuth Provider

Ok, we have our app set up with Auth.js, however, if you run the app right now, it won't work as we haven't configured our OAuth provider (**GitHub**) yet.

:::info
When using OAuth you're asking for a third-party service (in this case GitHub, although it could be Google, Twitter, etc...) to handle user authentication for your app.
:::

We need to register our new app in GitHub, so that when Auth.js forwards the authorization requests to it, GitHub can recognize your application and prompt the user to sign in.

<img src={creatingOauthAppImg} />

Log in to **GitHub**, go to `Settings / Developers / OAuth Apps` and click "New OAuth App"

Next, you'll be presented with a screen to add details about your new application. Fill in the required fields, but pay extra attention to the **Authorization Callback URL** one:

<img src={addingCallbackUrlImg} />

The callback URL we insert should have the following pattern:

```
[origin]/api/auth/callback/[provider]
```

In this case, given we want to try our authentication working locally on our machine and we're using **GitHub** as our OAuth provider, it'll be:

<Tabs groupId="frameworks">
  <TabItem value="next" label="Next.js" default>

```
http://localhost:3000/api/auth/callback/github
```

:::info
Auth.js will already magically create this API endpoint for you when we start the application later. Note that because we're using Next.js, locally it starts our server on port `3000`. Hence, the origin is `http://localhost:3000`.
:::

  </TabItem>
  <TabItem value="sveltekit" label="SvelteKit">

  ```
  http://localhost:5173/auth/callback/github
  ```

  </TabItem>
  <TabItem value="solidstart" label="SolidStart">
    TODO SolidStart
  </TabItem>
</Tabs>
To register, tap on "Register application" button.

The next screen shows all the configurations for your newly created OAuth app. For now, we need two things from it - the **Client ID** and **Client Secret**:

<img src={gettingClientIdSecretImg} />

The Client ID is always there, a public identifier of your OAuth application within GitHub. Click on the **Generate a new client Secret** button and should be presented with a new string (which is just a randomized string).

:::warning
üî• Keep both your Client ID and Client Secret secure and never expose them to the public or shared them with people outside your organization. With them, a malicious actor could hijack your application and cause you and your user serious problems!
:::

Cool! We have finished configuring our OAuth provider, now let's wire all together so we can finally see authentication working in our app!

:::info
As noted previously, Auth.js has built-in support for multiple OAuth providers, <a href="">here is the full list</a>. You can also easily build your own in case the provider you need is not on the list.

Note that, for each provider, the configuration process will be similar to what we just did:

1. Log in to the provider
2. Create create your OAuth application within it
3. Set the callback URL
4. Get the Client ID and Generate a Client Secret
:::

## 3. Wiring all together

Finally, we just need to reference our **Client ID** and **Client Secret** we just generated in the previous in our Auth.js config. In this way, the library will be able to use them when forwarding users to GitHub, and GitHub will be able to recognize the request as generated from our application.

Now let's copy both the Client ID and Client Secret and paste them into an environment file in the root of your project like so:

``` title=".env.local"
GITHUB_ID=12345
GITHUB_SECRET=67890
```

Here is our API route file again:

<Tabs groupId="frameworks">
  <TabItem value="next" label="Next.js" default>

```ts title="pages/api/auth/[...nextauth].ts"
import NextAuth from "next-auth"
import GithubProvider from "next-auth/providers/github"

export default NextAuth({
  providers: [
    GithubProvider({
      clientId: process.env.GITHUB_ID,
      clientSecret: process.env.GITHUB_SECRET,
    }),
  ],
})
```

Great! We're now ready to run our application locally. Start the Next.js app by running on your terminal the following command and navigating to [`http://localhost:3000`](http://localhost:3000):

```
$ npm run next dev
```

  </TabItem>
  <TabItem value="sveltekit" label="SvelteKit">
TODO SvelteKit
  </TabItem>
  <TabItem value="solidstart" label="SolidStart">
TODO SolidStart
  </TabItem>
</Tabs>

You should see the following page:

<img src={startAppAndSignInImg} />

Click on "Sign in" and then on "Sign in with GitHub": Auth.js will redirect you to GitHub, and GitHub will recognize our app [that we just registered](#2-configuring-oauth-provider) and ask the user (in this case you) to enter its credentials to proceed:

<img src={githubAuthCredentials} />

Once inserted and correct, GitHub will redirect the user to our app and Auth.js will take care of any further calls with GitHub to get access to the user profile and start a user session safely in the background:

<img src={nextAuthUserLoggedIn} />

Great! We have completed the whole E2E authentication flow setup so that users can log in to our application through GitHub!

:::info
You can create your Sign In page instead of using the default one from Auth.js. You can learn how to do so in our dedicated guide for it.
:::

## 4. Deploying to production

### Configuring different environments

It's normal to test your application in different environments. Usually, you'll have a development environment (when you run the application locally on your machine), a staging environment (for team members to try the application), and a production environment.

For each environment, you need to create an OAuth application in your provider respectively, as [we did previously](#2-configuring-oauth-provider), and point the **callback URL** to it.

For instance, in the previous section, we pointed the callback URL to `http://localhost:3000/api/auth/callback/github` as we wanted to test our application in the development environment.

If we were to deploy our app to production, we would need to create a new **OAuth App** in GitHub (calling it something like "Van life ‚Äì prod") and point the **callback URL** to our production domain: `https://example.com/api/auth/callback/github`

Finally, we would need to point the environment variables we set ( `GITHUB_ID` and `GITHUB_SECRET` ) to the credentials of the OAuth app we want our application to run with.

### Setting up `NEXTAUTH_URL`

:::tip
Skip this section if you are deploying to Vercel.
:::

When deploying your site, **you need to set** the `NEXTAUTH_URL` environment variable to the canonical URL of your website:

```
NEXTAUTH_URL=https://example.com
```

:::warning
In production, this needs to be set as an environment variable on the service you use to deploy your app.

To set environment variables on Vercel, you can use the [dashboard](https://vercel.com/dashboard) or the `vercel env pull` [command](https://vercel.com/docs/build-step#development-environment-variables).
:::

For more information please check out our [deployment page](/guides/basics/deployment).
