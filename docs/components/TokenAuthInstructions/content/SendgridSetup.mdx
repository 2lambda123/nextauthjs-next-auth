import { Callout, Steps, Tabs } from "nextra/components"
import { Code } from "@/components/Code"
import { Screenshot } from "@/components/Screenshot"
import MagicLink from "../../../public/img/magic-links/start.webp"

### Sendgrid Setup

To setup "magic links" we can use the builtin Sendgrid provider. This login mechanism starts by the user providing their email address at the login form. Then a **Verification Token** is sent to the provided email address. The user then has 24 hours to click the link in the email body to "consume" that token and register their account, otherwise the verification token will expire and they will have to request a new one.

<Callout>
  An Email Provider can be used with both [JSON Web Tokens](https://jwt.io/) and
  [database](/concepts/session-strategies#database-session) session, whichever
  you choose, you **must still configure a database** so that Auth.js can save
  the verification tokens and look them up when the user attempts to login. It
  is not possible to enable an email provider without using a database.
</Callout>

<Steps>

### Database Adapter

Please make sure you've [setup a database adapter](/docs/database), as mentioned earlier,
a database is required for passwordless login to work as verification tokens need to be stored.

### Sendgrid Provider

To configure Sendgrid, you'll just need to define your API key as an environment variable. If you use this exact name, `AUTH_SENDGRID_KEY`, then the Sendgrid provider will automatically pick it up and your provider array in the Auth.js config can be simplified, see the example below.

```bash filename=".env"
AUTH_SENDGRID_KEY=abc123
```

<Code>
<Code.Next>

```ts filename="./auth.ts"
import NextAuth from "next-auth"
import Sendgrid from "next-auth/providers/sendgrid"

export const { handlers, auth, signIn, signOut } = NextAuth({
  providers: [Sendgrid],
})
```

</Code.Next>
<Code.Svelte>

```ts filename="./src/auth.ts"
import SvelteKitAuth from "@auth/sveltekit"
import Sendgrid from "@auth/sveltekit/providers/sendgrid"

export const { handlers, auth, signIn, signOut } = SvelteKitAuth({
  providers: [Sendgrid],
})
```

</Code.Svelte>
</Code>

<Callout type="info">
  Check our [Customising magic links emails](/) to learn how to change the look
  and feel of the emails the user receives to sign in.
</Callout>

### Signin Button

Next, we can add a sign in button somewhere in your application like the Navbar. This will forward the user on to the Auth.js default signin page.

<Code>
<Code.Next>

```tsx filename="./components/sign-in.tsx"
import { signIn } from "../../auth.ts"

export function SignIn() {
  return (
    <form
      action={async () => {
        "use server"
        await signIn()
      }}
    >
      <button type="submit">Sign In</button>
    </form>
  )
}
```

</Code.Next>
<Code.Svelte>

```ts filename="src/routes/+page.svelte"
<script lang="ts">
  import { signIn } from '@auth/sveltekit/client'
</script>

<div>
  <nav>
    <img src="/img/logo.svg" alt="Company Logo" />
    <button on:click={signIn}>Signin</button>
  </nav>
</div>
```

</Code.Svelte>
</Code>

### Signin

Start your application, click on the sign in button we just added, and you should see Auth.js [built-in sign in page](/tutorials/custom-pages/built-in-pages) with the option to sign in with your email:

<Screenshot src={MagicLink} alt="Screenshot of sign in page" />

Insert your email and click "Sign in with Email". You should receive an email from Auth.js, click on it and should be redirected to your application, landing already authenticated.

</Steps>
