import { Steps, Callout } from "nextra/components"
import { Code } from "@/components/Code"

<Steps>
### Install Auth.js

Start by installing the appropriate package for your framework:

<Code>
  <Code.Next>
    
    ```bash npm2yarn
    npm install next-auth@beta
    ```

  </Code.Next>
  <Code.Svelte>
  
    ```bash npm2yarn
    npm install @auth/sveltekit
    ```
  </Code.Svelte>
  <Code.Express>
  
    ```bash npm2yarn
    npm install @auth/express
    ```
  
  </Code.Express>
</Code>

<Callout type="info">
  As a user, you should never have to interact with `@auth/core`, so installing it is not necessary. 
</Callout>

### Setup Environment

The only mandatory environment variable is `AUTH_SECRET`, a random value Auth.js uses to encrypt tokens and email
verification hashes. Visit the [Deployment](/getting-started/deployment) document to learn more.

You can generate the value for `AUTH_SECRET` by running the following command:

```bash
npx auth secret
```

Alternatively, you can use the following [`openssl`](https://github.com/openssl/openssl) command, which should be available on all Linux and macOS systems:

```bash
openssl rand -base64 33
```

Use the output in the terminal as the value of `AUTH_SECRET` in your `.env.local` file:

```bash filename=".env.local"
AUTH_SECRET=secret
```

### Configure Auth.js

Next, create the Auth.js config file and object, where you can control the library's behavior and specify custom authentication logic, adapters, etc.

We recommend that you create an `auth.ts` file in the project, regardless of the framework you are using. You can use `auth.ts` to pass options to the framework-specific initialization function and export authentication route handlers, sign-in and sign-out methods, and more.

<Callout type="info">
  You can name the Auth.js config file whatever you like and place it wherever you want within your project. The following are conventions we've developed.
</Callout>

<Code>
  <Code.Next>

1. Create an `auth.ts` file under the root project directory with the following content:

```ts filename="./auth.ts"
import NextAuth from "next-auth"

export const { handlers, signIn, signOut, auth } = NextAuth({
  providers: [],
})
```

2. Create a [dynamic API route](https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes) where you can use a [catch-all segment](https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes#catch-all-segments) to handle all authentication-related requests:
    - If you haven't already, create an `api` directory under the `/app/` directory. 
    - Create an `auth` directory under the newly created `/app/api/` directory.
    - Create a `[...nextauth]` directory under the new `auth/` directory.
    - Create a `route.ts` file under the `[...nextauth]/` directory.

3. Add the following content to the `/app/api/auth/[...nextauth]/route.ts` file:

<Callout>
  This `route.ts` file must define an [App Router route handler](https://nextjs.org/docs/app/building-your-application/routing/route-handlers). However, the rest of your app can stay under `page/` if you'd like.
</Callout>

```ts filename="./app/api/auth/[...nextauth]/route.ts"
import { handlers } from "@/auth" // Refers to the auth.ts file we just created
export const { GET, POST } = handlers
```

4. Add optional [Next.js middleware](https://nextjs.org/docs/app/building-your-application/routing/middleware) to keep the session alive by updating the session expiry every time it's called:

<Callout>
  If you haven't already created a `middleware.ts` file in your Next.js project, follow the [Next.js middleware naming and file placement conventions](https://nextjs.org/docs/app/building-your-application/routing/middleware#convention) to do so.
</Callout>

```ts filename="./middleware.ts"
export { auth as middleware } from "@/auth"
```

  </Code.Next>
  <Code.Svelte>

1. Start by creating a new `auth.ts` file in your `src/` directory with the following content.

```ts filename="./src/auth.ts"
import { SvelteKitAuth } from "@auth/sveltekit"

export const { handle } = SvelteKitAuth({
  providers: [],
})
```

2. Re-export the `handle` method in SvelteKit's `src/hooks.server.ts` file.

```ts filename="./src/hooks.server.ts"
export { handle } from "./auth"
```

3. That handle function adds an `auth()` method onto our `event.locals`, which is available in any `+layout.server.ts` or `+page.server.ts` file. Therefore, we can access the session in our `load` function like this.

```ts filename="./src/routes/+layout.server.ts" {4}
import type { LayoutServerLoad } from "./$types"

export const load: LayoutServerLoad = async (event) => {
  const session = await event.locals.auth()

  return {
    session,
  }
}
```

  </Code.Svelte>
  <Code.Express>

1. Start by importing `ExpressAuth` and adding the handler to the auth route.

```ts filename="./src/routes/auth.route.ts" {1, 9}
import { ExpressAuth } from "@auth/express"
import express from "express"

const app = express()

// If your app is served through a proxy
// trust the proxy to allow us to read the `X-Forwarded-*` headers
app.set("trust proxy", true)
app.use("/auth/*", ExpressAuth({ providers: [] }))
```

Note that this creates the Auth.js API but does not yet protect resources. For more details, continue to [protecting resources](/getting-started/session-management/protecting).

  </Code.Express>
</Code>

### Auth.js Setup Completed

The basic Auth.js setup is complete! Next, we'll set up an authentication method and fill out the `providers` array defined in the `auth.ts` file.

</Steps>
